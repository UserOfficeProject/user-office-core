<html lang="en">
<head>
  <meta charset="utf-8" />

  <!-- Bootstrap CSS -->
  <link
    href="http://localhost:4500/static/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
    crossorigin="anonymous"
  />

  <link href="http://localhost:4500/fonts/segoeui" rel="stylesheet">

  <style>
    body {
      font-size: 16px;
      line-height: 2;
      font-family: SegoeUI;
    }
    td,
    td h6 {
      line-height: 1.5;
    }
    .bold {
      font-weight: bold;
    }
    .w-40 {
      width: 40%;
    }
    .w-60 {
      width: 60%;
    }
    .no-break-inside {
      break-inside: avoid;
    }
    .break-before {
      break-before: page;
    }
    .link-page a::after {
      content: target-counter(attr(href), page);
    }

    .link-page::after {
      content: ', ';
    }

    .link-page:last-of-type::after {
      content: none;
    }

    .index-value::after {
      content: ' â€“ ';
    }
  </style>
  <script src="http://localhost:4500/static/js/paged.polyfill.min.js"></script>
</head>

<body>
  <!--<div id="bookIndex"></div>-->
  <div id="listindexgenerated"></div>
  <div class="root break-before" style="background: 'red'">
    <div class="container-fluid m-0 p-0">
      <div class="row" data-book-index="Proposal Summary">
        <div class="col">
          <h2 class="text-center mb-4 bold">{{ proposal.title }}</h2>
          <div class="mb-4">
            <h4 class="bold">Proposal ID</h4>
            {{ proposal.proposalId }}
          </div>
          <div class="mb-4">
            <h4 class="bold">Brief Summary</h4>
            {{ proposal.abstract }}
          </div>

          <div>
            <h4 class="bold" class="mb-2">Proposal Team</h4>
            <div class="row">
              <div class="col-4">
                <p>Principal Investigator:</p>
              </div>
              <div class="col-8">
                <span
                  >{{ principalInvestigator.firstname }} {{
                  principalInvestigator.lastname }}, {{
                  principalInvestigator.position }}, {{
                  principalInvestigator.institution }}</span
                >
              </div>
            </div>
            {{#if coProposers }}
            <div class="row">
              <div class="col-4">
                <p>Co-Investigator:</p>
              </div>
              <div class="col-8">
                {{#each coProposers}}
                <span
                  >{{ this.firstname }} {{ this.lastname }}, {{
                  this.institution }}</span
                >
                {{/each}}
              </div>
            </div>
            {{/if}}
          </div>
        </div>
      </div>

      <div
        class="row break-before"
        data-book-index="Proposal Questionary - Basic Information"
      >
        <div class="col">
        {{#each questionarySteps}}
        {{#if ($eq this.topic.title "Basic Information")}}
        <h2
          class="text-center bold my-3"
          data-book-index-parent="Proposal Questionary - Basic Information"
          data-book-index="{{{this.topic.title}}}"
        >
          {{ this.topic.title }}
        </h2>
          <div class="mb-4">
            {{#each this.fields}} 
              {{#if ($eq this.question.dataType 'EMBELLISHMENT')}}
                {{#if ($notEq this.config.omitFromPdf true )}}
                 
                      <h4 class="bold m-0">{{ this.config.plain }}</h4>
                 
                {{/if}}
              {{ else }}
                 <h4 class="bold m-0">{{ this.question.question }}</h4>
                 <div>
                  {{#if ($eq this.question.dataType 'SAMPLE_DECLARATION')}}
                  {{#unless this.value}}
                  <div class="mb-2"><em>Left blank</em></div>
                  {{/unless}} {{#each this.value}} {{ this.title }} -
                  <em>See appendix</em>
                  <br /><br />
                  {{/each}} {{else if ($eq this.question.dataType
                  'NUMBER_INPUT')}} {{#if this.value.value}} {{
                  this.value.value }} {{ this.value.unit.unit }} {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType 'BOOLEAN')}}
                  {{#if this.value}}Yes{{else}}No{{/if}} {{else if ($eq
                  this.question.dataType 'INTERVAL')}} {{#if ($or
                  this.value.min this.value.max)}} {{ this.value.min }} - {{
                  this.value.max }} {{#if this.value.unit}} {{
                  this.value.unit.unit }} {{/if}} {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType 'DATE')}}
                  {{#if this.value}} {{$utcDate this.value}} {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'DYNAMIC_MULTIPLE_CHOICE')}} {{#if this.value}} {{$join
                  this.value ', '}} {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'SELECTION_FROM_OPTIONS')}} {{#if this.value}} {{$join
                  this.value ', '}} {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'TEXT_INPUT')}} {{#if this.value}} {{ this.value }}
                  {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'RICH_TEXT_INPUT')}} {{#if this.value}} {{{this.value}}}
                  {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'INSTRUMENT_PICKER')}} {{#if this.value}} {{{this.value}}}
                  {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'FILE_UPLOAD')}} {{!-- {{#if this.value}} {{{$attachment
                  this.value ../../attachmentsFileMeta}}} {{else}}
                  <em>Left blank</em>
                  {{/if}} --}} {{/if}}
                 </div>
              {{/if}} 
            {{/each}}
          </div>
        </div>
        {{/if}}
        {{/each}}
      </div>
      <div
        class="row break-before"
        data-book-index="Proposal Questionary - Experiment Description"
      >
        <div class="col">
        {{#each questionarySteps}}
        {{#if ($eq this.topic.title "Experiment Description")}}
          <h2
            class="text-center mb-4 bold"
            data-book-index-parent="Proposal Questionary - Experiment Description"
            data-book-index="{{{this.topic.title}}}"
          >
            {{ this.topic.title }}
          </h2>
            <div class="mb-4">
            {{#each this.fields}} 
              {{#if ($eq this.question.dataType 'EMBELLISHMENT')}}
                {{#if ($notEq this.config.omitFromPdf true )}}
                  <h4 class="bold m-0">{{ this.config.plain }}</h4>  
                {{/if}}
              {{ else }}
                <h4 class="bold m-0">{{ this.question.question }}</h4>
                <div>
                  {{#if ($eq this.question.dataType 'SAMPLE_DECLARATION')}}
                  {{#unless this.value}}
                  <div class="mb-2"><em>Left blank</em></div>
                  {{/unless}} {{#each this.value}} {{ this.title }} -
                  <em>See appendix</em>
                  <br /><br />
                  {{/each}} {{else if ($eq this.question.dataType
                  'NUMBER_INPUT')}} {{#if this.value.value}} {{
                  this.value.value }} {{ this.value.unit.unit }} {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType 'BOOLEAN')}}
                  {{#if this.value}}Yes{{else}}No{{/if}} {{else if ($eq
                  this.question.dataType 'INTERVAL')}} {{#if ($or
                  this.value.min this.value.max)}} {{ this.value.min }} - {{
                  this.value.max }} {{#if this.value.unit}} {{
                  this.value.unit.unit }} {{/if}} {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType 'DATE')}}
                  {{#if this.value}} {{$utcDate this.value}} {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'DYNAMIC_MULTIPLE_CHOICE')}} {{#if this.value}} {{$join
                  this.value ', '}} {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'SELECTION_FROM_OPTIONS')}} {{#if this.value}} {{$join
                  this.value ', '}} {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'TEXT_INPUT')}} {{#if this.value}} {{ this.value }}
                  {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'RICH_TEXT_INPUT')}} {{#if this.value}} {{{this.value}}}
                  {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'INSTRUMENT_PICKER')}} {{#if this.value}} {{{this.value}}}
                  {{else}}
                  <em>Left blank</em>
                  {{/if}} {{else if ($eq this.question.dataType
                  'FILE_UPLOAD')}} {{!-- {{#if this.value}} {{{$attachment
                  this.value ../../attachmentsFileMeta}}} {{else}}
                  <em>Left blank</em>
                  {{/if}} --}} {{/if}} 
                </div>
              {{/if}}
              {{/each}}
              </div>
        {{/if}}
        {{/each}}
      </div>
      <div
        class="break-before"
        data-book-index="Proposal Questionary - Samples"
      >
        <h2
            class="bold my-3"
            data-book-index-parent="Proposal Questionary - Samples"
            data-book-index="Samples, Targets and Materials"
          >
            Samples, Targets and Materials
        </h2>
        <div>
          {{#each answers.User_Provided_Samples}}
          <div
            class="row mt-4 my-3"
            data-book-index-parent="Samples, Targets and Materials"
            data-book-index="User Provided Samples, Targets and Materials"
          >
            <div class="col">
              <h4 class="bold" class="mb-4">User Provided Samples, Targets and Materials {{ $sum @index 1 }}</h4>
              <div class="row my-2">
                <div class="col-4 bold">Name of material:</div>
                <div class="col-8">{{ Name_Of_Material }}</div>
              </div>
              <div class="row my-2">
                <div class="col-4 bold">Type of material:</div>
                <div class="col-8">{{ Type_Of_Material }}</div>
              </div>
              <div class="row my-2">
                <div class="col-4 bold">Estimated amount:</div>
                <div class="col-8">{{ Estimated_Amount }}</div>
              </div>
              <div class="row my-2">
                <div class="col-4 bold">Handling requirements:</div>
                <div class="col-8">{{ Handling_Requirements }}</div>
              </div>
              <div class="row my-2">
                <div class="col-4 bold">All associated hazards:</div>
                <div class="col-8">{{ All_Associated_Hazards }}</div>
              </div>
            </div>
          </div>
        {{/each}}
        </div>
        <div>
          {{#each answers.ELI_Provided_Samples}}
          <div
            class="row mt-4 my-3"
            data-book-index-parent="Samples, Targets and Materials"
            data-book-index="Requested Samples, Targets and Materials from ELI"
          >
            <div class="col">
              <h4 class="bold" class="mb-4">Samples, Targets and Materials from ELI {{ $sum @index 1 }}</h4>
              <div class="row my-2">
                <div class="col-4 bold">Name of material:</div>
                <div class="col-8">{{ Name_Of_Material }}</div>
              </div>
              <div class="row my-2">
                <div class="col-4 bold">Type of material:</div>
                <div class="col-8">{{ Type_Of_Material }}</div>
              </div>
              <div class="row my-2">
                <div class="col-4 bold">Estimated amount:</div>
                <div class="col-8">{{ Estimated_Amount }}</div>
              </div>
              <div class="row my-2">
                <div class="col-4 bold">Handling requirements:</div>
                <div class="col-8">{{ Handling_Requirements }}</div>
              </div>
              <div class="row my-2">
                <div class="col-4 bold">All associated hazards:</div>
                <div class="col-8">{{ All_Associated_Hazards }}</div>
              </div>
            </div>
          </div>
        {{/each}}
        </div>
      </div>
      <div
        class="break-before"
        data-book-index="Proposal Questionary - Attachments"
      >
        <h2
            class="bold my-3"
            data-book-index-parent="Proposal Questionary - Attachments"
            data-book-index="Attachments"
          >
            Attachments
        </h2>
        {{#each questionarySteps}}
        {{#each this.fields}} 
            {{#if ($eq this.question.dataType 'FILE_UPLOAD')}}
              {{#if this.value}} 
                {{{$attachment this.value ../../attachmentsFileMeta}}} 
              {{/if}}
            {{/if}}
        {{/each}}
        {{/each}}
      </div>
      {{#if ($eq userRole.shortCode "user_officers")}}
        <!--Visible to User officer-->
        {{#if technicalReviews}} 
        <div
          class="break-before"
          data-book-index="Technical Reviews"
        >
          <h2
              class="bold my-3"
              data-book-index-parent="Technical Reviews"
              data-book-index="Technical Reviews - List"
            >
              Technical Reviews
          </h2>
          {{#each technicalReviews}}
          {{#if this.submitted }}
          <div
            class="row mt-4 my-3"
            
          >
            <div class="col">
              <h4 class="bold" class="mb-4">Technical Review {{ $sum @index 1 }}</h4>
              <div class="row my-2">
                <div class="col-4 bold">Status:</div>
                <div class="col-8">{{ this.status }}</div>
              </div>
    
              <div class="row my-2">
                <div class="col-4 bold">Time Allocation:</div>
                <div class="col-8">{{ this.timeAllocation }}</div>
              </div>
    
              <div class="row my-2">
                <div class="col-4 bold">Comment:</div>
                <div class="col-8">{{{ this.publicComment }}}</div>
              </div>
            </div>
          </div>
          {{/if}} {{/each}}
        </div>
        {{/if}}
        
        {{#if fapReviews}}
        <div
          class="break-before"
          data-book-index="PRP Reviews"
        >
          <h2
              class="bold my-3"
              data-book-index-parent="PRP Reviews"
              data-book-index="PRP Reviews - List"
            >
              PRP Reviews
          </h2>
          {{#each fapReviews}}
          {{#if this.status }}
          <div class="row mt-4 my-3" 
            >
            <div class="col">
              <h4 class="bold" class="mb-4">PRP REVIEW {{ $sum @index 1 }}</h4>
    
              <div class="row my-2">
                <div class="col-4 bold">Grade:</div>
                <div class="col-8">{{ this.grade }}</div>
              </div>
    
              <div class="row my-2">
                <div class="col-4 bold">Comment:</div>
                <div class="col-8">{{{ this.comment }}}</div>
              </div>
            </div>
          </div>
          {{/if}} {{/each}}
        </div>
        {{/if}}
      {{/if}}
    </div>
  </div>
</body>
<script>
  function createIndex(config) {
    let indexElements = document.querySelectorAll("[data-book-index]");
    let indices = [];
    let num = 0;
    for (let i = 0; i < indexElements.length; ++i) {
      let indexElement = indexElements[i];

      // create array with all data-book-index
      let indexKey = indexElement.dataset.bookIndex;
      let indexKeyFirst = indexKey.slice(0, 1);

      let indexParent = indexElement.dataset.bookIndexParent;
      indices.push({ indexKey, indexParent });

      // create id for span whithout
      num++;
      if (indexElement.id == '') {
        indexElement.id = 'book-index-' + num;
      }
    }

    // create <ul> element for the index
    let indexElementDiv = document.querySelector(config.indexElement);
    let indexUl = document.createElement('ul');
    indexUl.id = 'list-index-generated';
    indexElementDiv.appendChild(indexUl);

    // create <li> element for the index
    indices.forEach((index) => {
      // create <li> element for the index
      let indexNewLi = document.createElement('li');
      indexNewLi.classList.add('list-index-element');

      const indexKey = index.indexKey;
      const indexParent = index.indexParent;

      indexNewLi.dataset.listIndex = indexKey;
      if (indexParent) indexNewLi.dataset.listIndexParent = indexParent;
      indexUl.appendChild(indexNewLi);
    });

    let indexLi = document
      .getElementById('list-index-generated')
      .getElementsByClassName('list-index-element');

    for (var n = 0; n < indexLi.length; n++) {
      // find data and add HTML of the list
      let dataIndex = indexLi[n].dataset.listIndex;
      let spanIndex = document.querySelectorAll(
        "[data-book-index='" + dataIndex + "']"
      );
      indexLi[n].innerHTML =
        '<span class="index-value">' +
        dataIndex +
        '</span><span class="links-pages"></span>';

      // add span for link page
      spanIndex.forEach(function (elem) {
        spanIndexId = elem.id;
        let spanPage = document.createElement('span');
        spanPage.classList.add('link-page');
        spanPage.innerHTML = '<a href="#' + spanIndexId + '"></a>';
        indexLi[n]
          .getElementsByClassName('links-pages')[0]
          .appendChild(spanPage);
      });
    }
  }
  createIndex({
    indexElement: '#bookIndex',
  });
</script>
</html>
