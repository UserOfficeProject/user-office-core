name: build
on: [push, workflow_dispatch]

permissions:
  actions: write   # needed for listing runners

jobs:
  choose-runner:
    runs-on: ubuntu-latest
    outputs:
      runs_on: ${{ steps.pick.outputs.runs_on }}
    steps:
      - id: pick
        uses: actions/github-script@v7
        with:
          script: |
            const isEven = (context.runNumber % 2) === 0
            core.setOutput('runs_on', isEven
              ? '["self-hosted","Linux","X64"]'
              : '"ubuntu-latest"'
            )

  build:
    needs: choose-runner
    runs-on: ${{ fromJSON(needs.choose-runner.outputs.runs_on) }}
    steps:
      - id: fake-build
        run: |
          echo "Using runner labels: ${{ needs.choose-runner.outputs.runs_on }}"
          echo "Runner name: $(hostname)"
          sleep 3
          echo "Build complete"

      